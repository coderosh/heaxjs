!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t="undefined"!=typeof globalThis?globalThis:t||self).HeaxVerlet={})}(this,(function(t){"use strict";class i{constructor(t=0,s=0){t instanceof i?(this.x=t.x,this.y=t.y):(this.x=t,this.y=s)}add(t=0,s=0){return t instanceof i?this.add(t.x,t.y):(this.x+=t,this.y+=s,this)}sub(t=0,s=0){return t instanceof i?this.sub(t.x,t.y):(this.x-=t,this.y-=s,this)}scale(t){return this.x*=t,this.y*=t,this}lenSqr(){const{x:t,y:i}=this;return t*t+i*i}len(){return Math.sqrt(this.lenSqr())}normalize(){const t=this.len();return 0!==t&&this.scale(1/t),this}dist(t=0,s=0){return t instanceof i?t.copy().sub(this).len():this.dist(new i(t,s))}equals(t=0,s=0){return t instanceof i?this.equals(t.x,t.y):this.x===t&&this.y===s}dot(t=0,s=0){return t instanceof i?this.dot(t.x,t.y):this.x*t+this.y*s}lerp(t=0,s=0,e=.5){return t instanceof i?this.lerp(t.x,t.y,s||.5):(this.x+=e*(t-this.x),this.y+=e*(s-this.y),this)}nlerp(t=0,s=0,e=.5){return t instanceof i?this.lerp(t,s||.5).normalize():this.nlerp(new i(t,s),e)}copy(){return new i(this)}}class s{constructor(t){this.pos=new i(0,0),this.down=!1,this.draggedParticle=null,this.highlightColor="black",this.selectRadius=20,this.onStart=()=>{this.down=!0},this.onMove=t=>{const i=this.heax.canvas.getBoundingClientRect();this.pos.x=t.clientX-i.left,this.pos.y=t.clientY-i.top},this.onEnd=()=>{this.down=!1,this.draggedParticle=null},this.heax=t,t.canvas.addEventListener("mousedown",this.onStart),t.canvas.addEventListener("mousemove",this.onMove),t.canvas.addEventListener("mouseup",this.onEnd),t.canvas.addEventListener("touchstart",this.onStart),t.canvas.addEventListener("touchmove",(t=>this.onMove(t.touches[0]))),t.canvas.addEventListener("touchend",this.onEnd),t.canvas.addEventListener("touchcancel",this.onEnd)}drag(t=!0){this.down||(this.draggedParticle=this.nearestParticle()),this.draggedParticle&&(t&&this.draw(),this.down&&(this.draggedParticle.position=this.pos.copy()))}draw(){const t=this.heax.ctx,i=this.draggedParticle;t.beginPath(),t.arc(i.position.x,i.position.y,1.5*i.radius,0,2*Math.PI),t.strokeStyle=this.highlightColor,t.lineWidth=1,t.stroke(),t.closePath()}nearestParticle(){let t=1/0,i=null;for(const s of this.heax.composites)for(const e of s.particles){const s=this.pos.dist(e.position);s<this.selectRadius&&s<t&&(t=s,i=e)}return i}}class e{constructor(t,s,e,o={}){this.heax=e,this.position=t||new i,this.oldPosition=s||new i,this.radius=o.radius||5,this.color=o.color||"black",this.mass=o.mass||1,this.hidden=o.hidden||!1,this.pinned=o.pinned||!1,this.velocity=this.position.copy().sub(this.oldPosition).add(this.heax.gravity)}render(){if(this.hidden)return;const{ctx:t}=this.heax;return t.beginPath(),t.fillStyle=this.color,t.arc(this.position.x,this.position.y,this.radius,0,2*Math.PI),t.fill(),t.closePath(),this}update(){if(!this.pinned)return this.velocity=this.position.copy().sub(this.oldPosition).scale(this.heax.friction),this.oldPosition.x=this.position.x,this.oldPosition.y=this.position.y,this.velocity.add(this.heax.gravity),this.position.y>=this.heax.height-this.radius&&this.velocity.lenSqr()>0&&(this.velocity.x*=this.heax.groundFriction),this.position.add(this.velocity),this}constrain(){const{bounce:t,width:i,height:s}=this.heax;return this.position.x>i-this.radius?(this.position.x=i-this.radius,this.oldPosition.x=this.position.x+this.velocity.x*t):this.position.x<this.radius&&(this.position.x=this.radius,this.oldPosition.x=this.position.x+this.velocity.x*t),this.position.y>s-this.radius?(this.position.y=s-this.radius,this.oldPosition.y=this.position.y+this.velocity.y*t):this.position.y<this.radius&&(this.position.y=this.radius,this.oldPosition.y=this.position.y+this.velocity.y*t),this}}class o{constructor(t,i,s,e={}){this.particle1=t,this.particle2=i,this.heax=s,this.color=e.color||"black",this.width=e.width||1,this.hidden=e.hidden||!1,this.distance=e.distance||t.position.dist(i.position),this.stiffness=e.stiffness||1}render(){if(this.hidden)return;const{ctx:t}=this.heax;return t.beginPath(),t.lineWidth=this.width,t.moveTo(this.particle1.position.x,this.particle1.position.y),t.lineTo(this.particle2.position.x,this.particle2.position.y),t.strokeStyle=this.color,t.stroke(),t.closePath(),this}update(){const t=this.particle1.position.copy().sub(this.particle2.position),i=t.len();t.scale((this.distance-i)/i*this.stiffness*.5);const s=this.particle1.mass+this.particle2.mass;return this.particle1.pinned||(this.particle1.position.x+=t.x*this.particle1.mass/s,this.particle1.position.y+=t.y*this.particle1.mass/s),this.particle2.pinned||(this.particle2.position.x-=t.x*this.particle2.mass/s,this.particle2.position.y-=t.y*this.particle2.mass/s),this}}class n{constructor(t,i=5){this.particles=[],this.constraints=[],this.heax=t,this.iterations=i}addParticle(...t){const[s,o,n,h,r]=t;let a,c,d;if("number"==typeof s)a=new i(s,o),c=new i(n,h),d=r;else{if(!(s instanceof i))throw new Error("Invalid arguments");a=s,c=o,d=n}const l=new e(a,c,this.heax,d);return this.particles.push(l),l}addConstraint(t,i,s){"number"==typeof t&&(t=this.particles[t]),"number"==typeof i&&(i=this.particles[i]);const e=new o(t,i,this.heax,s);return this.constraints.push(e),e}render(){for(const t of this.constraints)t.render();for(const t of this.particles)t.render();return this}update(t=!0){for(const t of this.particles)t.update();for(let i=0;i<this.iterations;i++){for(const t of this.constraints)t.update();if(t)for(const t of this.particles)t.constrain()}return this}hideConstraints(){for(const t of this.constraints)t.hidden=!0;return this}hideParticles(){for(const t of this.particles)t.hidden=!0;return this}tear(t){for(const i of this.constraints){i.particle1.position.dist(i.particle2.position)>t&&(this.constraints=this.constraints.filter((t=>t!=i)))}return this}}t.Composite=n,t.Constraint=o,t.Heax=class{constructor(t=document.querySelector("canvas")){this.friction=.999,this.groundFriction=.95,this.gravity=new i(0,.5),this.bounce=.9,this.composites=[],this.canvas=t,this.ctx=t.getContext("2d"),this.height=this.canvas.height,this.width=this.canvas.width,this.mouse=new s(this)}clear(){return this.ctx.clearRect(0,0,this.width,this.height),this}render(){for(const t of this.composites)t.render();return this}update(t){for(const i of this.composites)i.update(t);return this}createRectangle(t=0,i=0,s=100,e=100,o,h){const r=new n(this);r.addParticle(t,i,t,i,o),r.addParticle(t+s,i,t+s,e,o),r.addParticle(t+s,i+e,t+s,i+e,o),r.addParticle(t,i+e,t,i+e,o);for(let t=0;t<=3;t++)r.addConstraint(t,3==t?0:t+1,h);return r.addConstraint(1,3,h),r.addConstraint(0,2,h),this.composites.push(r),r}createRope(t=(t=>({x:100+15*t,y:100+15*t})),i=15,s,e){const o=new n(this);for(let e=0;e<i;e++){const{x:i,y:n}=t(e);o.addParticle(i,n,i,n,s)}for(let t=0;t<i-1;t++)o.addConstraint(t,(t+1)%i,e);return this.composites.push(o),o}createCloth(t=0,s=0,e=250,o=250,h=9,r=2,a,c){const d=new i(t,s),l=new n(this),p=e/h,u=o/h;for(let t=0;t<h;t++)for(let i=0;i<h;i++){let s=d.x+i*p,e=d.y+t*u,o=l.addParticle(s,e,s,e,a);0!==i&&l.addConstraint(o,t*h+i-1,c),0!==t&&l.addConstraint(o,(t-1)*h+i,c),0===t&&i%r==0&&(o.pinned=!0)}return this.composites.push(l),l}},t.Mouse=s,t.Particle=e,t.Vector=i,Object.defineProperty(t,"__esModule",{value:!0})}));
