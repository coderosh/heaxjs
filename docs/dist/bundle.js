(()=>{"use strict";class t{constructor(t=0,s=0){this.x=t,this.y=s}add(t){this.x+=t.x,this.y+=t.y}sub(t){this.x-=t.x,this.y-=t.y}lenSqr(){return this.x*this.x+this.y*this.y}dist(s){return Math.sqrt(t.sub(this,s).lenSqr())}length(){return Math.sqrt(this.lenSqr())}copy(){return new t(this.x,this.y)}scale(t){return this.x*=t,this.y*=t,this}static sub(s,i){return new t(s.x-i.x,s.y-i.y)}}const s=t,i=class{constructor(t,i,h,o={}){const{radius:e=5,color:n="black",hidden:d=!1,pinned:a=!1,mass:r=1}=o;this.pos=t||new s,this.oldPos=i||this.pos.copy(),this.heax=h,this.radius=e,this.color=n,this.hidden=d,this.pinned=a,this.mass=r,this.vel=s.sub(this.pos,this.oldPos),this.vel.add(this.heax.gravity)}render(){this.hidden||(this.heax.ctx.beginPath(),this.heax.ctx.fillStyle=this.color,this.heax.ctx.arc(this.pos.x,this.pos.y,this.radius,0,2*Math.PI),this.heax.ctx.fill(),this.heax.ctx.closePath())}update(){this.pinned||(this.vel=s.sub(this.pos,this.oldPos).scale(this.heax.friction),this.oldPos.x=this.pos.x,this.oldPos.y=this.pos.y,this.vel.add(this.heax.gravity),this.pos.y>=this.heax.height-this.radius&&this.vel.lenSqr()>0&&(this.vel.x*=this.heax.groundFriction),this.pos.add(this.vel))}constrain(){const{bounce:t,width:s,height:i}=this.heax;this.pos.x>s-this.radius?(this.pos.x=s-this.radius,this.oldPos.x=this.pos.x+this.vel.x*t):this.pos.x<this.radius&&(this.pos.x=this.radius,this.oldPos.x=this.pos.x+this.vel.x*t),this.pos.y>i-this.radius?(this.pos.y=i-this.radius,this.oldPos.y=this.pos.y+this.vel.y*t):this.pos.y<this.radius&&(this.pos.y=this.radius,this.oldPos.y=this.pos.y+this.vel.y*t)}},h=class{constructor(t,s,i,h={}){const{distance:o=t.pos.dist(s.pos),stiffness:e=1,color:n="black",width:d=1,hidden:a=!1}=h;this.p1=t,this.p2=s,this.color=n,this.stiffness=e,this.distance=o,this.width=d,this.hidden=a,this.heax=i}update(){const t=s.sub(this.p1.pos,this.p2.pos),i=t.length();t.scale((this.distance-i)/i*this.stiffness*.5);const h=this.p1.mass+this.p2.mass;this.p1.pinned||(this.p1.pos.x+=t.x*this.p1.mass/h,this.p1.pos.y+=t.y*this.p1.mass/h),this.p2.pinned||(this.p2.pos.x-=t.x*this.p2.mass/h,this.p2.pos.y-=t.y*this.p2.mass/h)}render(){if(this.hidden)return;const{ctx:t}=this.heax;t.beginPath(),t.lineWidth=this.width,t.moveTo(this.p1.pos.x,this.p1.pos.y),t.lineTo(this.p2.pos.x,this.p2.pos.y),t.strokeStyle=this.color,t.stroke(),t.closePath()}},o=class{constructor(t,s=5){this.heax=t,this.points=[],this.sticks=[],this.iterations=s,this.cDC=this.heax.cDC}addPoint(t,h,o,e,n){const d=new s(t,h),a=new s(o,e),r=new i(d,a,this.heax,n);return this.points.push(r),r}addStick(t,s,i){"number"==typeof t&&(t=this.points[t]),"number"==typeof s&&(s=this.points[s]);const o=new h(t,s,this.heax,i);return this.sticks.push(o),o}render(){for(const t of this.sticks)t.render();for(const t of this.points)t.render()}update(){for(const t of this.points)t.update();for(let t=0;t<this.iterations;t++){for(const t of this.sticks)t.update();if(!this.cDC)for(const t of this.points)t.constrain()}}hideSticks(){for(const t of this.sticks)t.hidden=!0}hidePoints(){for(const t of this.points)t.hidden=!0}tear(t){for(const s of this.sticks)s.p1.pos.dist(s.p2.pos)>t&&(this.sticks=this.sticks.filter((t=>t!=s)))}};window.Heax=class{constructor(t=document.querySelector("canvas")){this.canvas=t,this.ctx=this.canvas.getContext("2d"),this.height=this.canvas.height,this.width=this.canvas.width,this.friction=.999,this.groundFriction=.95,this.gravity=new s(0,.5),this.bounce=.9,this.composites=[],this.cDC=!1,this.mouse=new class{constructor(t){this._onStart=()=>{this.down=!0},this._onMove=t=>{const s=this.heax.canvas.getBoundingClientRect();this.pos.x=t.clientX-s.left,this.pos.y=t.clientY-s.top},this._onEnd=()=>{this.down=!1,this.draggedPpoint=null},this.heax=t,this.pos=new s,this.down=!1,this.draggedPpoint=null,this.highlightColor="black",this.selectRadius=20;const{canvas:i}=this.heax;i.addEventListener("mousedown",this._onStart),i.addEventListener("mousemove",this._onMove),window.addEventListener("mouseup",this._onEnd),i.addEventListener("touchstart",this._onStart),i.addEventListener("touchmove",(t=>this._onMove(t.touches[0]))),window.addEventListener("touchend",this._onEnd),window.addEventListener("touchcancel",this._onEnd)}drag(t=!0){this.down||(this.draggedPpoint=this.nearestPoint()),this.draggedPpoint&&(t&&this.draw(),this.down&&(this.draggedPpoint.pos=this.pos.copy()))}draw(){let t=this.draggedPpoint;this.heax.ctx.beginPath(),this.heax.ctx.arc(t.pos.x,t.pos.y,1.5*t.radius,0,2*Math.PI),this.heax.ctx.strokeStyle=this.highlightColor,this.heax.ctx.lineWidth=1,this.heax.ctx.stroke(),this.heax.ctx.closePath()}nearestPoint(){let t=1/0,s=null;for(const i of this.heax.composites)for(const h of i.points){let i=h.pos.dist(this.pos);i<this.selectRadius&&i<t&&(t=i,s=h)}return s}}(this)}clear(){this.ctx.clearRect(0,0,this.width,this.height)}render(){for(const t of this.composites)t.render()}update(){for(const t of this.composites)t.update()}box(t=0,s=0,i=100,h=100,e,n){const d=new o(this);d.addPoint(t,s,t,s,e),d.addPoint(t+i,s,t+i,h,e),d.addPoint(t+i,s+h,t+i,s+h,e),d.addPoint(t,s+h,t,s+h,e);for(let t=0;t<=3;t++)d.addStick(t,3==t?0:t+1,n);return d.addStick(1,3,n),d.addStick(0,2,n),this.composites.push(d),d}rope(t,s=15,i,h){const e=new o(this);t=t||(t=>({x:100+15*t,y:100+15*t}));for(let h=0;h<s;h++){let{x:s,y:o}=t(h);e.addPoint(s,o,s,o,i)}for(let t=0;t<s-1;t++)e.addStick(t,(t+1)%s,h);return this.composites.push(e),e}cloth(t=new s(50,0),i=250,h=250,e=9,n=2,d,a){const r=new o(this),c=i/e,p=h/e;for(let s=0;s<e;s++)for(let i=0;i<e;i++){let h=t.x+i*c,o=t.y+s*p,l=r.addPoint(h,o,h,o,d);0===i||r.addStick(l,s*e+i-1,a),0===s||r.addStick(l,(s-1)*e+i,a),0==s&&i%n==0&&(l.pinned=!0)}return this.composites.push(r),r}tire(t=100,s=100,i=50,h=12,e=1,n=1,d,a){const r=new o(this),c=2*Math.PI/h;for(let o=0;o<h;o++){const h=t+Math.cos(c*o)*i,e=s+Math.sin(c*o)*i;r.addPoint(h,e,h,e,d)}const p=r.addPoint(t,s,t,s,d);for(let t=0;t<h;t++)r.addStick(t,(t+1)%h,{...a,stiffness:n}),r.addStick(t,p,{...a,stiffness:e}),r.addStick(t,(t+(5===h?6:5))%h,{...a,stiffness:n});return this.composites.push(r),r}},window.Vector=s,window.Point=i,window.Stick=h,window.Composite=o})();